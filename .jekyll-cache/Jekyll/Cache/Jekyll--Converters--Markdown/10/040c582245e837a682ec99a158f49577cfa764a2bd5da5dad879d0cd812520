I"º<h1 id="ç›¸æœº">ç›¸æœº</h1>

<hr />

<h3 id="æŠ•å½±">æŠ•å½±</h3>

<p><img src="https://raytracing.github.io/images/fig-1-11-1.jpg" alt="" /></p>

<p>Î¸æ˜¯å¯è§†è§’åº¦ï¼Œå›¾åƒçš„é«˜åº¦ <strong>h=tan(Î¸/2)</strong></p>

<p>æˆ‘ä»¬æƒ³è¦æˆ‘ä»¬çš„ç›¸æœºå¤„äºä»»æ„ä½ç½®å¹¶å¯ä»¥æŒ‡å‘ä»»æ„ä½ç½®ï¼Œå³ä» <strong>lookfrom</strong>æŒ‡å‘<strong>lookat</strong></p>

<p><img src="https://raytracing.github.io/images/fig-1-11-2.jpg" alt="" /></p>

<p>æˆ‘ä»¬è¦æ±‚å¾—å‚ç›´äº <strong>lookfrom-lookat</strong>å‘é‡çš„å¹³é¢ä¸Šçš„å•ä½å‘é‡ <strong>u</strong>ï¼Œ<strong>v</strong></p>

<p><img src="https://raytracing.github.io/images/fig-1-11-3.jpg" alt="" /></p>

<p>å·²çŸ¥æœ‰ <strong>vup</strong>ï¼Œ<strong>lookfrom-lookat</strong>ä¸¤ä¸ªå‘é‡ï¼Œæ±‚ <strong>u</strong>ï¼Œ<strong>v</strong>å‘é‡çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>

<p><strong>u=cross(vup,lookfrom)</strong></p>

<p><strong>v=cross(u,lookfrom)</strong></p>

<p><strong>u</strong>ï¼Œ<strong>v</strong>æ˜¯æŠ•å½±å¹³é¢æ°´å¹³å’Œç«–ç›´æ–¹å‘çš„æ­¥é•¿</p>

<hr />

<h3 id="æ™¯æ·±">æ™¯æ·±</h3>

<p>å…³äºæ™¯æ·±çš„ä»‹ç»ç¬”è€…ä¸å†èµ˜è¿°ï¼Œç”¨ä»£ç æ¨¡æ‹Ÿè¿™ç§æ•ˆæœçš„åŸºæœ¬æ€æƒ³å¦‚ä¸‹ï¼š</p>

<p><img src="https://raytracing.github.io/images/fig-1-12-2.jpg" alt="" /></p>

<p>å…³äºæˆåƒä½ç½®ï¼Œå¼•å…¥å‚æ•°focus_distä¹‹åï¼Œæˆåƒä½ç½®å°†ä¼šæ˜¯-focus_dist*wã€‚å›¾ç‰‡çš„é«˜å®½éƒ½éœ€è¦ä¹˜ä»¥å‚æ•°focus_distã€‚å…‰çº¿ä»é•œå¤´å†…çš„éšæœºä¸€ç‚¹å°„å‡ºï¼Œæ‰“åˆ°ç„¦å¹³é¢ä¸Š</p>

<hr />

<h3 id="ç›¸æœºç±»">ç›¸æœºç±»</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ifndef CAMERAH
#define CAMERAH

#include "random.h"
#include "ray.h"

vec3 random_in_unit_disk() {
    vec3 p;
    do {
        p = 2.0*vec3(random_double(),random_double(),0) - vec3(1,1,0);
    } while (dot(p,p) &gt;= 1.0);
    return p;
}

class camera {
    public:
        camera(vec3 lookfrom, vec3 lookat, vec3 vup, float vfov, float aspect,
               float aperture, float focus_dist) {
            lens_radius = aperture / 2;
            float theta = vfov*M_PI/180;
            float half_height = tan(theta/2);
            float half_width = aspect * half_height;
            origin = lookfrom;
            w = unit_vector(lookfrom - lookat);
            u = unit_vector(cross(vup, w));
            v = cross(w, u);
            lower_left_corner = origin
                              - half_width * focus_dist * u
                              - half_height * focus_dist * v
                              - focus_dist * w;
            horizontal = 2*half_width*focus_dist*u;
            vertical = 2*half_height*focus_dist*v;
        }

        ray get_ray(float s, float t) {
            vec3 rd = lens_radius*random_in_unit_disk();
            vec3 offset = u * rd.x() + v * rd.y();
            return ray(origin + offset,
                       lower_left_corner + s*horizontal + t*vertical
                           - origin - offset);
        }

        vec3 origin;
        vec3 lower_left_corner;
        vec3 horizontal;
        vec3 vertical;
        vec3 u, v, w;
        float lens_radius;
};
#endif
</code></pre></div></div>

<p>cameraç±»çš„æ„é€ å‡½æ•°ä¸­</p>

<p>lookfromï¼šè§‚å¯Ÿç‚¹</p>

<p>lookatï¼šç›®æ ‡ç‚¹ï¼Œå³è§†é‡ä¸­å¿ƒ</p>

<p>vupï¼šæ‘„åƒæœºç«–ç›´ä¸Šæ–¹</p>

<p>vfovï¼šå¯è§†è§’åº¦</p>

<p>aspectï¼šé•¿å®½æ¯”</p>

<p>focus_distï¼šç„¦è·</p>

<p>apertureï¼šå…‰åœˆå¤§å°</p>

<hr />

<p>ä¿®æ”¹mainå‡½æ•°ä¸­ä¸‹é¢è¯­å¥</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vec3 lookfrom(3,3,2);
vec3 lookat(0,0,-1);
float dist_to_focus = (lookfrom-lookat).length();
float aperture = 2.0;

camera cam(lookfrom, lookat, vec3(0,1,0), 50,
           float(nx)/float(ny), aperture, dist_to_focus);
</code></pre></div></div>

<p>å°†è§‚å¯Ÿç‚¹æ”¾ç½®åœ¨(-2,2,1)ï¼ŒæŒ‡å‘(0,0,-1)ï¼ˆä¸­é—´è“çƒçš„ä¸­å¿ƒï¼‰ï¼Œyè½´ä¸ºä¸Šæ–¹ï¼Œå¯è§†è§’åº¦ä¸º90åº¦â€¦</p>

<hr />

<p>ç»“æœå¦‚ä¸‹</p>

<p><img src="https://pic.downk.cc/item/5e25db982fb38b8c3ca6713c.png" alt="" /></p>

:ET