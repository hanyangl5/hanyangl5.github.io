I"ø<h1 id="æŠ—é”¯é½¿">æŠ—é”¯é½¿</h1>

<hr />

<h3 id="randomç±»">randomç±»</h3>

<p>å…ˆå¼•ç”¨æˆ‘ä»¬ä¸Šä¸€ç« æ‰€ç”Ÿæˆçš„å›¾åƒ</p>

<p><img src="https://pic.downk.cc/item/5e2180132fb38b8c3c398a66.png" alt="" /></p>

<p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨çƒä½“çš„è¾¹ç¼˜ä¼šæœ‰æ˜æ˜¾çš„é”¯é½¿æ„Ÿï¼Œå‡å°‘é”¯é½¿æ„Ÿçš„æ–¹æ³•æ˜¯ï¼Œåœ¨è®¡ç®—æŸä¸€ä¸ªåƒç´ çš„é¢œè‰²æ—¶ï¼Œè®¡ç®—å®ƒé‚»è¿‘çš„åŒºåŸŸå†…å¤šä¸ªé‡‡æ ·ç‚¹çš„é¢œè‰²ï¼Œå¹¶æ±‚å¹³å‡å€¼ï¼Œå› æ­¤æˆ‘ä»¬å¼•å…¥ä¸€ä¸ªrandomç±»</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ifndef RANDOMH
#define RANDOMH

#include &lt;cstdlib&gt;

inline double random_double() {
    return rand() / (RAND_MAX + 1.0);
}
#endif
</code></pre></div></div>

<p>random_doubleå‡½æ•°ç”Ÿæˆä¸€ä¸ª(0,1)ä¹‹é—´çš„æµ®ç‚¹æ•°</p>

<hr />

<h3 id="cameraç±»">cameraç±»</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#ifndef CAMERAH
#define CAMERAH

#include "ray.h"

class camera {
    public:
        camera() {
            lower_left_corner = vec3(-2.0, -1.0, -1.0);
            horizontal = vec3(4.0, 0.0, 0.0);
            vertical = vec3(0.0, 2.0, 0.0);
            origin = vec3(0.0, 0.0, 0.0);
        }
        ray get_ray(float u, float v) {
            return ray(origin,
                       lower_left_corner + u*horizontal + v*vertical - origin);
        }

        vec3 origin;
        vec3 lower_left_corner;
        vec3 horizontal;
        vec3 vertical;
};
#endif
</code></pre></div></div>

<p>ameraç±»ç”¨äºå‘å°„ä¸åŒçš„å…‰çº¿ï¼Œç”¨äºé‡‡æ ·</p>

<hr />

<p>ä¿®æ”¹åçš„mainå‡½æ•°</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "svpng.inc"
#include "sphere.h"
#include "hittablelist.h"
#include "camera.h"
#include "random.h"
#include&lt;cfloat&gt;

vec3 color(const ray&amp; r, hittable *world) {
    hit_record rec;
    if (world-&gt;hit(r, 0.0, FLT_MAX, rec)) {
        return 0.5*vec3(rec.normal.x()+1, rec.normal.y()+1, rec.normal.z()+1);
    }
    else{
    vec3 unit_direction = unit_vector(r.direction());
    float t = 0.5*(unit_direction.y() + 1.0);
    return (1.0-t)*vec3(1.0, 1.0, 1.0) + t*vec3(0.5, 0.7, 1.0);   
    }
 
}

int main() {

    int nx=600,ny=300,ns=100;
    unsigned char rgb[nx * ny * 3], *p = rgb;
    FILE *fp = fopen("test.png", "wb");

    vec3 lower_left_corner(-2.0, -1.0, -1.0);
    vec3 horizontal(4.0, 0.0, 0.0);
    vec3 vertical(0.0, 2.0, 0.0);
    vec3 origin(0.0, 0.0, 0.0);
    camera cam;
    hittable *list[2];
    list[0] = new sphere(vec3(0,0,-1), 0.5);
    list[1] = new sphere(vec3(0,-100.5,-1), 100);
    hittable *world = new hittable_list(list,2);

    for (int j = ny-1; j &gt;= 0; j--){
        for (int i = 0; i &lt; nx; i++) {
            vec3 col(0,0,0);
            for(int s = 0; s &lt; ns ; s++){
                float u = float(i + random_double()) / float(nx);
                float v = float(j + random_double()) / float(ny);
                ray r = cam.get_ray(u,v);               
                col += color(r, world);           
            }
            col /= float(ns);
            *p++ = int(255.99*col[0]);    /* R */
            *p++ = int(255.99*col[1]);    /* G */
            *p++ = int(255.99*col[2]);    /* B */   
        }
    }
    svpng(fp, nx, ny, rgb, 0);
    fclose(fp); 
    return 0;
}
</code></pre></div></div>

<p>æˆ‘ä»¬ä»¥é‡‡æ ·100æ¬¡ä¸ºä¾‹ï¼ˆns=100ï¼‰</p>

<hr />

<p>æ¸²æŸ“å‡ºçš„å›¾ç‰‡å¦‚ä¸‹</p>

<p><img src="https://pic.downk.cc/item/5e226b362fb38b8c3c4eef5c.png" alt="" /></p>

<p>çƒä½“è¾¹ç¼˜å¤„çš„åƒç´ é”¯é½¿æ„Ÿæ˜æ˜¾é™ä½</p>
:ET