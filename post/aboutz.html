<?xml version='1.0' encoding='UTF-8'?>
<link rel="stylesheet" href="/github-markdown-css/github-css.css">

<meta content="text/html" charset="UTF-8">


<div class="gist">
    <style class="formula-style">
        svg.gh-md-to-html-formula {
            fill: black;
        }
    </style>
    <div class="gist-file"> <!-- This is the class that is responsible for the boxing! -->
        <div class="gist-data">
            <div class="js-gist-file-update-container js-task-list-container file-box">
                <div id="article-aboutz" class="file">
                    <div id="file-docker-image-pull-md-readme" class="Box-body readme blob js-code-block-container p-5 p-xl-6"
                         style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px">
                        <article class="markdown-body entry-content container-lg" itemprop="text">
                            <h3>
<a id="user-content-z_buffer为什么是非线性的" class="anchor" href="#z_buffer%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%9E%E7%BA%BF%E6%80%A7%E7%9A%84" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>z_buffer为什么是非线性的</h3>
<p>引用<a href="http://www.humus.name/index.php?page=News&amp;ID=255" rel="nofollow">humus:A couple of notes about Z</a>的一句话</p>
<p>While W is linear in view space it's not linear in screen space. Z, which is non-linear in view space, is on the other hand linear in screen space</p>
<h3>
<a id="user-content-z_buffer精度问题" class="anchor" href="#z_buffer%E7%B2%BE%E5%BA%A6%E9%97%AE%E9%A2%98" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>z_buffer精度问题</h3>
<p>在投影阶段，我们将view space中的z值映射成了关于1/z的函数
得到一个如下形式的函数图像
<a href="https://camo.githubusercontent.com/0a6acb313a386313e8d19644e23500144c175f1e25cc58ffcb68ca11fd2f313f/68747470733a2f2f7069632e646f776e6b2e63632f6974656d2f3566336136393032313431393561613539346134393962372e706e67" target="_blank" rel="nofollow"><img src="https://camo.githubusercontent.com/0a6acb313a386313e8d19644e23500144c175f1e25cc58ffcb68ca11fd2f313f/68747470733a2f2f7069632e646f776e6b2e63632f6974656d2f3566336136393032313431393561613539346134393962372e706e67" alt="" data-canonical-src="https://pic.downk.cc/item/5f3a690214195aa594a499b7.png" style="max-width:100%;"></a></p>
<p>在近平面时，z''的精度较高，深度缓冲有较好的表现，我们在深度缓冲时可以很容易判断出物体的前后</p>
<p>在远平面附近，同样z值相差为1，z''的值相差很小，甚至会计算出相同的深度值，这时就无法分辨哪个物体在前，哪个物体在后，这就是depth precision error(z fighting)</p>
<p><a href="https://camo.githubusercontent.com/7ed303131e2280d171956d1dee71808517a0967229a88384f614464b795668db/68747470733a2f2f7069632e646f776e6b2e63632f6974656d2f3566336136393032313431393561613539346134393962342e706e67" target="_blank" rel="nofollow"><img src="https://camo.githubusercontent.com/7ed303131e2280d171956d1dee71808517a0967229a88384f614464b795668db/68747470733a2f2f7069632e646f776e6b2e63632f6974656d2f3566336136393032313431393561613539346134393962342e706e67" alt="" data-canonical-src="https://pic.downk.cc/item/5f3a690214195aa594a499b4.png" style="max-width:100%;"></a></p>
z fighting 
<p><strong>解决方法：</strong></p>
<ul>
<li>
<p>将znear设置的尽可能小可以改善z''的分布，将更多的变化空间留给远平面</p>
</li>
<li>
<p>使用无限远平面</p>
</li>
<li>
<p>用精度更高的数据类型存储</p>
</li>
<li>
<p>使投影矩阵与其他矩阵分开，并将其应用于顶点着色器中的单独操作中，而不是将其组合到视图矩阵中-</p>
</li>
</ul>
<p>P.S.</p>
<blockquote>
<p>Differentiating depth between close objects is more important than differentiating depth between far objects</p>
</blockquote>

<h3>
<a id="user-content-reverse-z" class="anchor" href="#reverse-z" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>reverse-z</h3>
<p>在上面的描述中，zbuffer的值应该是近平面趋近0，远平面趋近1（DirectX），渲染出来的效果是近平面颜色深，远平面颜色浅，最近看到一篇博客在分析GTA5渲染时，zbuffer的值正好相反，是用了reverse-z的技术</p>
<p><a href="https://camo.githubusercontent.com/93f0a78a7330e474311c3a876dfeb4e6cf7b125661b276ad17b9622ab580e96a/68747470733a2f2f696d61676573323031352e636e626c6f67732e636f6d2f626c6f672f3530333132332f3230313630312f3530333132332d32303136303131323039323832303838322d3533373438393630312e6a7067" target="_blank" rel="nofollow"><img src="https://camo.githubusercontent.com/93f0a78a7330e474311c3a876dfeb4e6cf7b125661b276ad17b9622ab580e96a/68747470733a2f2f696d61676573323031352e636e626c6f67732e636f6d2f626c6f672f3530333132332f3230313630312f3530333132332d32303136303131323039323832303838322d3533373438393630312e6a7067" alt="" data-canonical-src="https://images2015.cnblogs.com/blog/503123/201601/503123-20160112092820882-537489601.jpg" style="max-width:100%;"></a></p>
<p>(Nvidia官方的案例是DirectX为例的)</p>
<p>DirectX中z的投影变换（z&gt;0，z映射到[0,1]）


<svg class="gh-md-to-html-formula" height="31.253284pt" style="vertical-align: middle;" version="1.1" viewbox="-.239051 -.226929 197.136324 31.253284" width="197.136324pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<path d="M7.878456-2.749689C8.081694-2.749689 8.296887-2.749689 8.296887-2.988792S8.081694-3.227895 7.878456-3.227895H1.41071C1.207472-3.227895 .992279-3.227895 .992279-2.988792S1.207472-2.749689 1.41071-2.749689H7.878456Z" id="g1-0n4"></path>
<path d="M3.124284-3.036613C3.052553-3.172105 2.82142-3.514819 2.335243-3.514819C1.3868-3.514819 .342715-2.406974 .342715-1.227397C.342715-.398506 .876712 .079701 1.490411 .079701C2.000498 .079701 2.438854-.326775 2.582316-.486177C2.725778 .063761 3.267746 .079701 3.363387 .079701C3.730012 .079701 3.913325-.223163 3.977086-.358655C4.136488-.645579 4.24807-1.107846 4.24807-1.139726C4.24807-1.187547 4.216189-1.243337 4.120548-1.243337S4.008966-1.195517 3.961146-.996264C3.849564-.557908 3.698132-.143462 3.387298-.143462C3.203985-.143462 3.132254-.294894 3.132254-.518057C3.132254-.653549 3.203985-.924533 3.251806-1.123786S3.419178-1.801245 3.451059-1.944707L3.610461-2.550436C3.650311-2.741719 3.737983-3.076463 3.737983-3.116314C3.737983-3.299626 3.58655-3.363387 3.482939-3.363387C3.363387-3.363387 3.164134-3.283686 3.124284-3.036613ZM2.582316-.860772C2.183811-.310834 1.769365-.143462 1.514321-.143462C1.147696-.143462 .964384-.478207 .964384-.892653C.964384-1.267248 1.179577-2.12005 1.354919-2.470735C1.586052-2.956912 1.976588-3.291656 2.343213-3.291656C2.86127-3.291656 3.012702-2.709838 3.012702-2.614197C3.012702-2.582316 2.81345-1.801245 2.765629-1.594022C2.662017-1.219427 2.662017-1.203487 2.582316-.860772Z" id="g2-97n4"></path>
<path d="M1.601993-1.817186C1.777335-1.817186 2.375093-1.825156 2.797509-1.976588C3.490909-2.215691 3.514819-2.693898 3.514819-2.81345C3.514819-3.259776 3.092403-3.514819 2.574346-3.514819C1.673724-3.514819 .390535-2.805479 .390535-1.39477C.390535-.581818 .884682 .079701 1.761395 .079701C3.004732 .079701 3.674222-.71731 3.674222-.828892C3.674222-.900623 3.594521-.956413 3.5467-.956413S3.474969-.932503 3.435118-.884682C2.805479-.143462 1.912827-.143462 1.777335-.143462C1.195517-.143462 1.020174-.637609 1.020174-1.083935C1.020174-1.323039 1.091905-1.681694 1.123786-1.817186H1.601993ZM1.187547-2.040349C1.44259-3.012702 2.16787-3.291656 2.574346-3.291656C2.893151-3.291656 3.196015-3.132254 3.196015-2.81345C3.196015-2.040349 1.888917-2.040349 1.554172-2.040349H1.187547Z" id="g2-101n4"></path>
<path d="M3.052553-3.172105H3.793773C3.953176-3.172105 4.048817-3.172105 4.048817-3.323537C4.048817-3.435118 3.945205-3.435118 3.809714-3.435118H3.100374C3.227895-4.152428 3.307597-4.606725 3.387298-4.96538C3.419178-5.100872 3.443088-5.188543 3.56264-5.284184C3.666252-5.371856 3.730012-5.387796 3.817684-5.387796C3.937235-5.387796 4.064757-5.363885 4.168369-5.300125C4.128518-5.284184 4.080697-5.260274 4.040847-5.236364C3.905355-5.164633 3.809714-5.021171 3.809714-4.861768C3.809714-4.678456 3.953176-4.566874 4.128518-4.566874C4.359651-4.566874 4.574844-4.766127 4.574844-5.045081C4.574844-5.419676 4.192279-5.610959 3.809714-5.610959C3.53873-5.610959 3.036613-5.483437 2.781569-4.750187C2.709838-4.566874 2.709838-4.550934 2.494645-3.435118H1.896887C1.737484-3.435118 1.641843-3.435118 1.641843-3.283686C1.641843-3.172105 1.745455-3.172105 1.880946-3.172105H2.446824L1.872976-.079701C1.721544 .72528 1.601993 1.40274 1.179577 1.40274C1.155666 1.40274 .988294 1.40274 .836862 1.307098C1.203487 1.219427 1.203487 .884682 1.203487 .876712C1.203487 .6934 1.060025 .581818 .884682 .581818C.669489 .581818 .438356 .765131 .438356 1.067995C.438356 1.40274 .781071 1.625903 1.179577 1.625903C1.665753 1.625903 2.000498 1.115816 2.10411 .916563C2.391034 .390535 2.574346-.605729 2.590286-.68543L3.052553-3.172105Z" id="g2-102n4"></path>
<path d="M1.594022-1.307098C1.617933-1.42665 1.697634-1.729514 1.721544-1.849066C1.833126-2.279452 1.833126-2.287422 2.016438-2.550436C2.279452-2.940971 2.654047-3.291656 3.188045-3.291656C3.474969-3.291656 3.642341-3.124284 3.642341-2.749689C3.642341-2.311333 3.307597-1.40274 3.156164-1.012204C3.052553-.749191 3.052553-.70137 3.052553-.597758C3.052553-.143462 3.427148 .079701 3.769863 .079701C4.550934 .079701 4.877709-1.036115 4.877709-1.139726C4.877709-1.219427 4.813948-1.243337 4.758157-1.243337C4.662516-1.243337 4.646575-1.187547 4.622665-1.107846C4.431382-.454296 4.096638-.143462 3.793773-.143462C3.666252-.143462 3.602491-.223163 3.602491-.406476S3.666252-.765131 3.745953-.964384C3.865504-1.267248 4.216189-2.183811 4.216189-2.630137C4.216189-3.227895 3.801743-3.514819 3.227895-3.514819C2.582316-3.514819 2.16787-3.124284 1.936737-2.82142C1.880946-3.259776 1.530262-3.514819 1.123786-3.514819C.836862-3.514819 .637609-3.331507 .510087-3.084433C.318804-2.709838 .239103-2.311333 .239103-2.295392C.239103-2.223661 .294894-2.191781 .358655-2.191781C.462267-2.191781 .470237-2.223661 .526027-2.430884C.621669-2.82142 .765131-3.291656 1.099875-3.291656C1.307098-3.291656 1.354919-3.092403 1.354919-2.917061C1.354919-2.773599 1.315068-2.622167 1.251308-2.359153C1.235367-2.295392 1.115816-1.825156 1.083935-1.713574L.789041-.518057C.757161-.398506 .70934-.199253 .70934-.167372C.70934 .01594 .860772 .079701 .964384 .079701C1.107846 .079701 1.227397-.01594 1.283188-.111582C1.307098-.159402 1.370859-.430386 1.41071-.597758L1.594022-1.307098Z" id="g2-110n4"></path>
<path d="M1.538232-1.099875C1.625903-1.44259 1.713574-1.785305 1.793275-2.13599C1.801245-2.15193 1.857036-2.383064 1.865006-2.422914C1.888917-2.494645 2.088169-2.82142 2.295392-3.020672C2.550436-3.251806 2.82142-3.291656 2.964882-3.291656C3.052553-3.291656 3.196015-3.283686 3.307597-3.188045C2.964882-3.116314 2.917061-2.82142 2.917061-2.749689C2.917061-2.574346 3.052553-2.454795 3.227895-2.454795C3.443088-2.454795 3.682192-2.630137 3.682192-2.948941C3.682192-3.235866 3.435118-3.514819 2.980822-3.514819C2.438854-3.514819 2.072229-3.156164 1.904857-2.940971C1.745455-3.514819 1.203487-3.514819 1.123786-3.514819C.836862-3.514819 .637609-3.331507 .510087-3.084433C.326775-2.725778 .239103-2.319303 .239103-2.295392C.239103-2.223661 .294894-2.191781 .358655-2.191781C.462267-2.191781 .470237-2.223661 .526027-2.430884C.621669-2.82142 .765131-3.291656 1.099875-3.291656C1.307098-3.291656 1.354919-3.092403 1.354919-2.917061C1.354919-2.773599 1.315068-2.622167 1.251308-2.359153C1.235367-2.295392 1.115816-1.825156 1.083935-1.713574L.789041-.518057C.757161-.398506 .70934-.199253 .70934-.167372C.70934 .01594 .860772 .079701 .964384 .079701C1.243337 .079701 1.299128-.143462 1.362889-.414446L1.538232-1.099875Z" id="g2-114n4"></path>
<path d="M3.443088-7.663263C3.443088-7.938232 3.443088-7.950187 3.203985-7.950187C2.917061-7.627397 2.319303-7.185056 1.08792-7.185056V-6.838356C1.362889-6.838356 1.960648-6.838356 2.618182-7.149191V-.920548C2.618182-.490162 2.582316-.3467 1.530262-.3467H1.159651V0C1.482441-.02391 2.642092-.02391 3.036613-.02391S4.578829-.02391 4.901619 0V-.3467H4.531009C3.478954-.3467 3.443088-.490162 3.443088-.920548V-7.663263Z" id="g4-49n4"></path>
<path d="M8.069738-3.873474C8.237111-3.873474 8.452304-3.873474 8.452304-4.088667C8.452304-4.315816 8.249066-4.315816 8.069738-4.315816H1.028144C.860772-4.315816 .645579-4.315816 .645579-4.100623C.645579-3.873474 .848817-3.873474 1.028144-3.873474H8.069738ZM8.069738-1.649813C8.237111-1.649813 8.452304-1.649813 8.452304-1.865006C8.452304-2.092154 8.249066-2.092154 8.069738-2.092154H1.028144C.860772-2.092154 .645579-2.092154 .645579-1.876961C.645579-1.649813 .848817-1.649813 1.028144-1.649813H8.069738Z" id="g4-61n4"></path>
<path d="M2.11208-3.777833C2.15193-3.881445 2.183811-3.937235 2.183811-4.016936C2.183811-4.27995 1.944707-4.455293 1.721544-4.455293C1.40274-4.455293 1.315068-4.176339 1.283188-4.064757L.270984-.629639C.239103-.533998 .239103-.510087 .239103-.502117C.239103-.430386 .286924-.414446 .366625-.390535C.510087-.326775 .526027-.326775 .541968-.326775C.565878-.326775 .613699-.326775 .669489-.462267L2.11208-3.777833Z" id="g0-48n4"></path>
<path d="M.514072 1.518306C.430386 1.876961 .382565 1.972603-.107597 1.972603C-.251059 1.972603-.37061 1.972603-.37061 2.199751C-.37061 2.223661-.358655 2.319303-.227148 2.319303C-.071731 2.319303 .095641 2.295392 .251059 2.295392H.765131C1.016189 2.295392 1.625903 2.319303 1.876961 2.319303C1.948692 2.319303 2.092154 2.319303 2.092154 2.10411C2.092154 1.972603 2.008468 1.972603 1.80523 1.972603C1.255293 1.972603 1.219427 1.888917 1.219427 1.793275C1.219427 1.649813 1.75741-.406476 1.829141-.681445C1.960648-.3467 2.283437 .119552 2.905106 .119552C4.25604 .119552 5.71457-1.637858 5.71457-3.395268C5.71457-4.495143 5.092902-5.272229 4.196264-5.272229C3.431133-5.272229 2.785554-4.531009 2.654047-4.363636C2.558406-4.961395 2.092154-5.272229 1.613948-5.272229C1.267248-5.272229 .992279-5.104857 .765131-4.65056C.549938-4.220174 .382565-3.490909 .382565-3.443088S.430386-3.335492 .514072-3.335492C.609714-3.335492 .621669-3.347447 .6934-3.622416C.872727-4.327771 1.099875-5.033126 1.578082-5.033126C1.853051-5.033126 1.948692-4.841843 1.948692-4.483188C1.948692-4.196264 1.912827-4.076712 1.865006-3.861519L.514072 1.518306ZM2.582316-3.730012C2.666002-4.064757 3.000747-4.411457 3.19203-4.578829C3.323537-4.698381 3.718057-5.033126 4.172354-5.033126C4.698381-5.033126 4.937484-4.507098 4.937484-3.88543C4.937484-3.311582 4.60274-1.960648 4.303861-1.338979C4.004981-.6934 3.455044-.119552 2.905106-.119552C2.092154-.119552 1.960648-1.147696 1.960648-1.195517C1.960648-1.231382 1.984558-1.327024 1.996513-1.3868L2.582316-3.730012Z" id="g3-112n4"></path>
<path d="M1.518306-.968369C2.032379-1.554172 2.450809-1.924782 3.048568-2.462765C3.765878-3.084433 4.076712-3.383313 4.244085-3.56264C5.080946-4.387547 5.499377-5.080946 5.499377-5.176588S5.403736-5.272229 5.379826-5.272229C5.296139-5.272229 5.272229-5.224408 5.212453-5.140722C4.913574-4.62665 4.62665-4.375592 4.315816-4.375592C4.064757-4.375592 3.93325-4.483188 3.706102-4.770112C3.455044-5.068991 3.251806-5.272229 2.905106-5.272229C2.032379-5.272229 1.506351-4.184309 1.506351-3.93325C1.506351-3.897385 1.518306-3.825654 1.625903-3.825654C1.721544-3.825654 1.733499-3.873474 1.769365-3.957161C1.972603-4.435367 2.546451-4.519054 2.773599-4.519054C3.024658-4.519054 3.263761-4.435367 3.514819-4.327771C3.969116-4.136488 4.160399-4.136488 4.27995-4.136488C4.363636-4.136488 4.411457-4.136488 4.471233-4.148443C4.076712-3.682192 3.431133-3.108344 2.893151-2.618182L1.685679-1.506351C.956413-.765131 .514072-.059776 .514072 .02391C.514072 .095641 .573848 .119552 .645579 .119552S.729265 .107597 .812951-.035866C1.004234-.334745 1.3868-.777086 1.829141-.777086C2.080199-.777086 2.199751-.6934 2.438854-.394521C2.666002-.131507 2.86924 .119552 3.251806 .119552C4.423412 .119552 5.092902-1.398755 5.092902-1.673724C5.092902-1.721544 5.080946-1.793275 4.961395-1.793275C4.865753-1.793275 4.853798-1.745455 4.817933-1.625903C4.554919-.920548 3.849564-.633624 3.383313-.633624C3.132254-.633624 2.893151-.71731 2.642092-.824907C2.163885-1.016189 2.032379-1.016189 1.876961-1.016189C1.75741-1.016189 1.625903-1.016189 1.518306-.968369Z" id="g3-122n4"></path>
</defs>
<g id="page1n4" transform="matrix(1.13 0 0 1.13 -63.986043 -60.741254)">
<use x="56.413267" xlink:href="#g3-122n4" y="69.590446"></use>
<use x="62.383874" xlink:href="#g0-48n4" y="64.65426"></use>
<use x="64.680817" xlink:href="#g0-48n4" y="64.65426"></use>
<use x="70.796722" xlink:href="#g4-61n4" y="69.590446"></use>
<use x="103.502232" xlink:href="#g3-122n4" y="61.502687"></use>
<use x="108.940123" xlink:href="#g2-102n4" y="63.29595"></use>
<use x="113.886889" xlink:href="#g2-97n4" y="63.29595"></use>
<use x="118.384899" xlink:href="#g2-114n4" y="63.29595"></use>
<rect height=".478187" width="57.606425" x="84.417717" y="66.36256"></rect>
<use x="84.417717" xlink:href="#g3-122n4" y="77.791108"></use>
<use x="89.855607" xlink:href="#g2-102n4" y="79.584371"></use>
<use x="94.802374" xlink:href="#g2-97n4" y="79.584371"></use>
<use x="99.300384" xlink:href="#g2-114n4" y="79.584371"></use>
<use x="106.511775" xlink:href="#g1-0n4" y="77.791108"></use>
<use x="118.466935" xlink:href="#g3-122n4" y="77.791108"></use>
<use x="123.904826" xlink:href="#g2-110n4" y="79.584371"></use>
<use x="129.043028" xlink:href="#g2-101n4" y="79.584371"></use>
<use x="132.971412" xlink:href="#g2-97n4" y="79.584371"></use>
<use x="137.469422" xlink:href="#g2-114n4" y="79.584371"></use>
<use x="145.876319" xlink:href="#g1-0n4" y="69.590446"></use>
<use x="164.381912" xlink:href="#g3-122n4" y="61.502687"></use>
<use x="169.819803" xlink:href="#g2-102n4" y="63.29595"></use>
<use x="174.766569" xlink:href="#g2-97n4" y="63.29595"></use>
<use x="179.264579" xlink:href="#g2-114n4" y="63.29595"></use>
<use x="187.7213" xlink:href="#g3-122n4" y="61.502687"></use>
<use x="193.15919" xlink:href="#g2-110n4" y="63.29595"></use>
<use x="198.297393" xlink:href="#g2-101n4" y="63.29595"></use>
<use x="202.225777" xlink:href="#g2-97n4" y="63.29595"></use>
<use x="206.723786" xlink:href="#g2-114n4" y="63.29595"></use>
<rect height=".478187" width="57.606425" x="159.026993" y="66.36256"></rect>
<use x="159.026993" xlink:href="#g3-122n4" y="77.791108"></use>
<use x="164.464884" xlink:href="#g2-102n4" y="79.584371"></use>
<use x="169.41165" xlink:href="#g2-97n4" y="79.584371"></use>
<use x="173.90966" xlink:href="#g2-114n4" y="79.584371"></use>
<use x="181.121051" xlink:href="#g1-0n4" y="77.791108"></use>
<use x="193.076211" xlink:href="#g3-122n4" y="77.791108"></use>
<use x="198.514102" xlink:href="#g2-110n4" y="79.584371"></use>
<use x="203.652304" xlink:href="#g2-101n4" y="79.584371"></use>
<use x="207.580688" xlink:href="#g2-97n4" y="79.584371"></use>
<use x="212.078698" xlink:href="#g2-114n4" y="79.584371"></use>
<use x="222.020823" xlink:href="#g4-49n4" y="61.502687"></use>
<rect height=".478187" width="11.845746" x="219.024445" y="66.36256"></rect>
<use x="219.024445" xlink:href="#g3-122n4" y="77.791108"></use>
<use x="224.995052" xlink:href="#g3-112n4" y="77.791108"></use>
</g>
</svg></p>
<p>标准的zbuffer精度曲线</p>
<p><a href="https://camo.githubusercontent.com/daec7082e2bba2b74a95f16ce857a5d7412645c4d7eb2d1a7793d3a7a99e618b/68747470733a2f2f646576656c6f7065722e6e76696469612e636f6d2f73697465732f64656661756c742f66696c65732f616b616d61692f67616d65776f726b732f626c6f672f4465707468707265636973696f6e2f6772617068342e6a7067" target="_blank" rel="nofollow"><img src="https://camo.githubusercontent.com/daec7082e2bba2b74a95f16ce857a5d7412645c4d7eb2d1a7793d3a7a99e618b/68747470733a2f2f646576656c6f7065722e6e76696469612e636f6d2f73697465732f64656661756c742f66696c65732f616b616d61692f67616d65776f726b732f626c6f672f4465707468707265636973696f6e2f6772617068342e6a7067" alt="" data-canonical-src="https://developer.nvidia.com/sites/default/files/akamai/gameworks/blog/Depthprecision/graph4.jpg" style="max-width:100%;"></a></p>
DirectX 
<p>reverse-z的做法是，将近平面映射到z=1，将远平面映射到z=0，使得浮点的准对数分布在某种程度上取消了1/z非线性，使我们在近平面上的精度与整数深度缓冲区相似，并且极大地提高了其他地方的精度</p>
<p>

<svg class="gh-md-to-html-formula" height="31.253284pt" style="vertical-align: middle;" version="1.1" viewbox="-.239051 -.226929 197.136324 31.253284" width="197.136324pt" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<path d="M7.878456-2.749689C8.081694-2.749689 8.296887-2.749689 8.296887-2.988792S8.081694-3.227895 7.878456-3.227895H1.41071C1.207472-3.227895 .992279-3.227895 .992279-2.988792S1.207472-2.749689 1.41071-2.749689H7.878456Z" id="g1-0n5"></path>
<path d="M3.124284-3.036613C3.052553-3.172105 2.82142-3.514819 2.335243-3.514819C1.3868-3.514819 .342715-2.406974 .342715-1.227397C.342715-.398506 .876712 .079701 1.490411 .079701C2.000498 .079701 2.438854-.326775 2.582316-.486177C2.725778 .063761 3.267746 .079701 3.363387 .079701C3.730012 .079701 3.913325-.223163 3.977086-.358655C4.136488-.645579 4.24807-1.107846 4.24807-1.139726C4.24807-1.187547 4.216189-1.243337 4.120548-1.243337S4.008966-1.195517 3.961146-.996264C3.849564-.557908 3.698132-.143462 3.387298-.143462C3.203985-.143462 3.132254-.294894 3.132254-.518057C3.132254-.653549 3.203985-.924533 3.251806-1.123786S3.419178-1.801245 3.451059-1.944707L3.610461-2.550436C3.650311-2.741719 3.737983-3.076463 3.737983-3.116314C3.737983-3.299626 3.58655-3.363387 3.482939-3.363387C3.363387-3.363387 3.164134-3.283686 3.124284-3.036613ZM2.582316-.860772C2.183811-.310834 1.769365-.143462 1.514321-.143462C1.147696-.143462 .964384-.478207 .964384-.892653C.964384-1.267248 1.179577-2.12005 1.354919-2.470735C1.586052-2.956912 1.976588-3.291656 2.343213-3.291656C2.86127-3.291656 3.012702-2.709838 3.012702-2.614197C3.012702-2.582316 2.81345-1.801245 2.765629-1.594022C2.662017-1.219427 2.662017-1.203487 2.582316-.860772Z" id="g2-97n5"></path>
<path d="M1.601993-1.817186C1.777335-1.817186 2.375093-1.825156 2.797509-1.976588C3.490909-2.215691 3.514819-2.693898 3.514819-2.81345C3.514819-3.259776 3.092403-3.514819 2.574346-3.514819C1.673724-3.514819 .390535-2.805479 .390535-1.39477C.390535-.581818 .884682 .079701 1.761395 .079701C3.004732 .079701 3.674222-.71731 3.674222-.828892C3.674222-.900623 3.594521-.956413 3.5467-.956413S3.474969-.932503 3.435118-.884682C2.805479-.143462 1.912827-.143462 1.777335-.143462C1.195517-.143462 1.020174-.637609 1.020174-1.083935C1.020174-1.323039 1.091905-1.681694 1.123786-1.817186H1.601993ZM1.187547-2.040349C1.44259-3.012702 2.16787-3.291656 2.574346-3.291656C2.893151-3.291656 3.196015-3.132254 3.196015-2.81345C3.196015-2.040349 1.888917-2.040349 1.554172-2.040349H1.187547Z" id="g2-101n5"></path>
<path d="M3.052553-3.172105H3.793773C3.953176-3.172105 4.048817-3.172105 4.048817-3.323537C4.048817-3.435118 3.945205-3.435118 3.809714-3.435118H3.100374C3.227895-4.152428 3.307597-4.606725 3.387298-4.96538C3.419178-5.100872 3.443088-5.188543 3.56264-5.284184C3.666252-5.371856 3.730012-5.387796 3.817684-5.387796C3.937235-5.387796 4.064757-5.363885 4.168369-5.300125C4.128518-5.284184 4.080697-5.260274 4.040847-5.236364C3.905355-5.164633 3.809714-5.021171 3.809714-4.861768C3.809714-4.678456 3.953176-4.566874 4.128518-4.566874C4.359651-4.566874 4.574844-4.766127 4.574844-5.045081C4.574844-5.419676 4.192279-5.610959 3.809714-5.610959C3.53873-5.610959 3.036613-5.483437 2.781569-4.750187C2.709838-4.566874 2.709838-4.550934 2.494645-3.435118H1.896887C1.737484-3.435118 1.641843-3.435118 1.641843-3.283686C1.641843-3.172105 1.745455-3.172105 1.880946-3.172105H2.446824L1.872976-.079701C1.721544 .72528 1.601993 1.40274 1.179577 1.40274C1.155666 1.40274 .988294 1.40274 .836862 1.307098C1.203487 1.219427 1.203487 .884682 1.203487 .876712C1.203487 .6934 1.060025 .581818 .884682 .581818C.669489 .581818 .438356 .765131 .438356 1.067995C.438356 1.40274 .781071 1.625903 1.179577 1.625903C1.665753 1.625903 2.000498 1.115816 2.10411 .916563C2.391034 .390535 2.574346-.605729 2.590286-.68543L3.052553-3.172105Z" id="g2-102n5"></path>
<path d="M1.594022-1.307098C1.617933-1.42665 1.697634-1.729514 1.721544-1.849066C1.833126-2.279452 1.833126-2.287422 2.016438-2.550436C2.279452-2.940971 2.654047-3.291656 3.188045-3.291656C3.474969-3.291656 3.642341-3.124284 3.642341-2.749689C3.642341-2.311333 3.307597-1.40274 3.156164-1.012204C3.052553-.749191 3.052553-.70137 3.052553-.597758C3.052553-.143462 3.427148 .079701 3.769863 .079701C4.550934 .079701 4.877709-1.036115 4.877709-1.139726C4.877709-1.219427 4.813948-1.243337 4.758157-1.243337C4.662516-1.243337 4.646575-1.187547 4.622665-1.107846C4.431382-.454296 4.096638-.143462 3.793773-.143462C3.666252-.143462 3.602491-.223163 3.602491-.406476S3.666252-.765131 3.745953-.964384C3.865504-1.267248 4.216189-2.183811 4.216189-2.630137C4.216189-3.227895 3.801743-3.514819 3.227895-3.514819C2.582316-3.514819 2.16787-3.124284 1.936737-2.82142C1.880946-3.259776 1.530262-3.514819 1.123786-3.514819C.836862-3.514819 .637609-3.331507 .510087-3.084433C.318804-2.709838 .239103-2.311333 .239103-2.295392C.239103-2.223661 .294894-2.191781 .358655-2.191781C.462267-2.191781 .470237-2.223661 .526027-2.430884C.621669-2.82142 .765131-3.291656 1.099875-3.291656C1.307098-3.291656 1.354919-3.092403 1.354919-2.917061C1.354919-2.773599 1.315068-2.622167 1.251308-2.359153C1.235367-2.295392 1.115816-1.825156 1.083935-1.713574L.789041-.518057C.757161-.398506 .70934-.199253 .70934-.167372C.70934 .01594 .860772 .079701 .964384 .079701C1.107846 .079701 1.227397-.01594 1.283188-.111582C1.307098-.159402 1.370859-.430386 1.41071-.597758L1.594022-1.307098Z" id="g2-110n5"></path>
<path d="M1.538232-1.099875C1.625903-1.44259 1.713574-1.785305 1.793275-2.13599C1.801245-2.15193 1.857036-2.383064 1.865006-2.422914C1.888917-2.494645 2.088169-2.82142 2.295392-3.020672C2.550436-3.251806 2.82142-3.291656 2.964882-3.291656C3.052553-3.291656 3.196015-3.283686 3.307597-3.188045C2.964882-3.116314 2.917061-2.82142 2.917061-2.749689C2.917061-2.574346 3.052553-2.454795 3.227895-2.454795C3.443088-2.454795 3.682192-2.630137 3.682192-2.948941C3.682192-3.235866 3.435118-3.514819 2.980822-3.514819C2.438854-3.514819 2.072229-3.156164 1.904857-2.940971C1.745455-3.514819 1.203487-3.514819 1.123786-3.514819C.836862-3.514819 .637609-3.331507 .510087-3.084433C.326775-2.725778 .239103-2.319303 .239103-2.295392C.239103-2.223661 .294894-2.191781 .358655-2.191781C.462267-2.191781 .470237-2.223661 .526027-2.430884C.621669-2.82142 .765131-3.291656 1.099875-3.291656C1.307098-3.291656 1.354919-3.092403 1.354919-2.917061C1.354919-2.773599 1.315068-2.622167 1.251308-2.359153C1.235367-2.295392 1.115816-1.825156 1.083935-1.713574L.789041-.518057C.757161-.398506 .70934-.199253 .70934-.167372C.70934 .01594 .860772 .079701 .964384 .079701C1.243337 .079701 1.299128-.143462 1.362889-.414446L1.538232-1.099875Z" id="g2-114n5"></path>
<path d="M3.443088-7.663263C3.443088-7.938232 3.443088-7.950187 3.203985-7.950187C2.917061-7.627397 2.319303-7.185056 1.08792-7.185056V-6.838356C1.362889-6.838356 1.960648-6.838356 2.618182-7.149191V-.920548C2.618182-.490162 2.582316-.3467 1.530262-.3467H1.159651V0C1.482441-.02391 2.642092-.02391 3.036613-.02391S4.578829-.02391 4.901619 0V-.3467H4.531009C3.478954-.3467 3.443088-.490162 3.443088-.920548V-7.663263Z" id="g4-49n5"></path>
<path d="M8.069738-3.873474C8.237111-3.873474 8.452304-3.873474 8.452304-4.088667C8.452304-4.315816 8.249066-4.315816 8.069738-4.315816H1.028144C.860772-4.315816 .645579-4.315816 .645579-4.100623C.645579-3.873474 .848817-3.873474 1.028144-3.873474H8.069738ZM8.069738-1.649813C8.237111-1.649813 8.452304-1.649813 8.452304-1.865006C8.452304-2.092154 8.249066-2.092154 8.069738-2.092154H1.028144C.860772-2.092154 .645579-2.092154 .645579-1.876961C.645579-1.649813 .848817-1.649813 1.028144-1.649813H8.069738Z" id="g4-61n5"></path>
<path d="M2.11208-3.777833C2.15193-3.881445 2.183811-3.937235 2.183811-4.016936C2.183811-4.27995 1.944707-4.455293 1.721544-4.455293C1.40274-4.455293 1.315068-4.176339 1.283188-4.064757L.270984-.629639C.239103-.533998 .239103-.510087 .239103-.502117C.239103-.430386 .286924-.414446 .366625-.390535C.510087-.326775 .526027-.326775 .541968-.326775C.565878-.326775 .613699-.326775 .669489-.462267L2.11208-3.777833Z" id="g0-48n5"></path>
<path d="M.514072 1.518306C.430386 1.876961 .382565 1.972603-.107597 1.972603C-.251059 1.972603-.37061 1.972603-.37061 2.199751C-.37061 2.223661-.358655 2.319303-.227148 2.319303C-.071731 2.319303 .095641 2.295392 .251059 2.295392H.765131C1.016189 2.295392 1.625903 2.319303 1.876961 2.319303C1.948692 2.319303 2.092154 2.319303 2.092154 2.10411C2.092154 1.972603 2.008468 1.972603 1.80523 1.972603C1.255293 1.972603 1.219427 1.888917 1.219427 1.793275C1.219427 1.649813 1.75741-.406476 1.829141-.681445C1.960648-.3467 2.283437 .119552 2.905106 .119552C4.25604 .119552 5.71457-1.637858 5.71457-3.395268C5.71457-4.495143 5.092902-5.272229 4.196264-5.272229C3.431133-5.272229 2.785554-4.531009 2.654047-4.363636C2.558406-4.961395 2.092154-5.272229 1.613948-5.272229C1.267248-5.272229 .992279-5.104857 .765131-4.65056C.549938-4.220174 .382565-3.490909 .382565-3.443088S.430386-3.335492 .514072-3.335492C.609714-3.335492 .621669-3.347447 .6934-3.622416C.872727-4.327771 1.099875-5.033126 1.578082-5.033126C1.853051-5.033126 1.948692-4.841843 1.948692-4.483188C1.948692-4.196264 1.912827-4.076712 1.865006-3.861519L.514072 1.518306ZM2.582316-3.730012C2.666002-4.064757 3.000747-4.411457 3.19203-4.578829C3.323537-4.698381 3.718057-5.033126 4.172354-5.033126C4.698381-5.033126 4.937484-4.507098 4.937484-3.88543C4.937484-3.311582 4.60274-1.960648 4.303861-1.338979C4.004981-.6934 3.455044-.119552 2.905106-.119552C2.092154-.119552 1.960648-1.147696 1.960648-1.195517C1.960648-1.231382 1.984558-1.327024 1.996513-1.3868L2.582316-3.730012Z" id="g3-112n5"></path>
<path d="M1.518306-.968369C2.032379-1.554172 2.450809-1.924782 3.048568-2.462765C3.765878-3.084433 4.076712-3.383313 4.244085-3.56264C5.080946-4.387547 5.499377-5.080946 5.499377-5.176588S5.403736-5.272229 5.379826-5.272229C5.296139-5.272229 5.272229-5.224408 5.212453-5.140722C4.913574-4.62665 4.62665-4.375592 4.315816-4.375592C4.064757-4.375592 3.93325-4.483188 3.706102-4.770112C3.455044-5.068991 3.251806-5.272229 2.905106-5.272229C2.032379-5.272229 1.506351-4.184309 1.506351-3.93325C1.506351-3.897385 1.518306-3.825654 1.625903-3.825654C1.721544-3.825654 1.733499-3.873474 1.769365-3.957161C1.972603-4.435367 2.546451-4.519054 2.773599-4.519054C3.024658-4.519054 3.263761-4.435367 3.514819-4.327771C3.969116-4.136488 4.160399-4.136488 4.27995-4.136488C4.363636-4.136488 4.411457-4.136488 4.471233-4.148443C4.076712-3.682192 3.431133-3.108344 2.893151-2.618182L1.685679-1.506351C.956413-.765131 .514072-.059776 .514072 .02391C.514072 .095641 .573848 .119552 .645579 .119552S.729265 .107597 .812951-.035866C1.004234-.334745 1.3868-.777086 1.829141-.777086C2.080199-.777086 2.199751-.6934 2.438854-.394521C2.666002-.131507 2.86924 .119552 3.251806 .119552C4.423412 .119552 5.092902-1.398755 5.092902-1.673724C5.092902-1.721544 5.080946-1.793275 4.961395-1.793275C4.865753-1.793275 4.853798-1.745455 4.817933-1.625903C4.554919-.920548 3.849564-.633624 3.383313-.633624C3.132254-.633624 2.893151-.71731 2.642092-.824907C2.163885-1.016189 2.032379-1.016189 1.876961-1.016189C1.75741-1.016189 1.625903-1.016189 1.518306-.968369Z" id="g3-122n5"></path>
</defs>
<g id="page1n5" transform="matrix(1.13 0 0 1.13 -63.986043 -60.741254)">
<use x="56.413267" xlink:href="#g3-122n5" y="69.590446"></use>
<use x="62.383874" xlink:href="#g0-48n5" y="64.65426"></use>
<use x="64.680817" xlink:href="#g0-48n5" y="64.65426"></use>
<use x="70.796722" xlink:href="#g4-61n5" y="69.590446"></use>
<use x="101.44233" xlink:href="#g3-122n5" y="61.502687"></use>
<use x="106.88022" xlink:href="#g2-110n5" y="63.29595"></use>
<use x="112.018423" xlink:href="#g2-101n5" y="63.29595"></use>
<use x="115.946807" xlink:href="#g2-97n5" y="63.29595"></use>
<use x="120.444816" xlink:href="#g2-114n5" y="63.29595"></use>
<rect height=".478187" width="57.606425" x="84.417717" y="66.36256"></rect>
<use x="84.417717" xlink:href="#g3-122n5" y="77.791108"></use>
<use x="89.855607" xlink:href="#g2-110n5" y="79.584371"></use>
<use x="94.99381" xlink:href="#g2-101n5" y="79.584371"></use>
<use x="98.922194" xlink:href="#g2-97n5" y="79.584371"></use>
<use x="103.420203" xlink:href="#g2-114n5" y="79.584371"></use>
<use x="110.631595" xlink:href="#g1-0n5" y="77.791108"></use>
<use x="122.586755" xlink:href="#g3-122n5" y="77.791108"></use>
<use x="128.024645" xlink:href="#g2-102n5" y="79.584371"></use>
<use x="132.971412" xlink:href="#g2-97n5" y="79.584371"></use>
<use x="137.469422" xlink:href="#g2-114n5" y="79.584371"></use>
<use x="145.876319" xlink:href="#g1-0n5" y="69.590446"></use>
<use x="164.381912" xlink:href="#g3-122n5" y="61.502687"></use>
<use x="169.819803" xlink:href="#g2-110n5" y="63.29595"></use>
<use x="174.958005" xlink:href="#g2-101n5" y="63.29595"></use>
<use x="178.886389" xlink:href="#g2-97n5" y="63.29595"></use>
<use x="183.384399" xlink:href="#g2-114n5" y="63.29595"></use>
<use x="191.84112" xlink:href="#g3-122n5" y="61.502687"></use>
<use x="197.27901" xlink:href="#g2-102n5" y="63.29595"></use>
<use x="202.225777" xlink:href="#g2-97n5" y="63.29595"></use>
<use x="206.723786" xlink:href="#g2-114n5" y="63.29595"></use>
<rect height=".478187" width="57.606425" x="159.026993" y="66.36256"></rect>
<use x="159.026993" xlink:href="#g3-122n5" y="77.791108"></use>
<use x="164.464884" xlink:href="#g2-110n5" y="79.584371"></use>
<use x="169.603086" xlink:href="#g2-101n5" y="79.584371"></use>
<use x="173.53147" xlink:href="#g2-97n5" y="79.584371"></use>
<use x="178.02948" xlink:href="#g2-114n5" y="79.584371"></use>
<use x="185.240871" xlink:href="#g1-0n5" y="77.791108"></use>
<use x="197.196031" xlink:href="#g3-122n5" y="77.791108"></use>
<use x="202.633922" xlink:href="#g2-102n5" y="79.584371"></use>
<use x="207.580688" xlink:href="#g2-97n5" y="79.584371"></use>
<use x="212.078698" xlink:href="#g2-114n5" y="79.584371"></use>
<use x="222.020823" xlink:href="#g4-49n5" y="61.502687"></use>
<rect height=".478187" width="11.845746" x="219.024445" y="66.36256"></rect>
<use x="219.024445" xlink:href="#g3-122n5" y="77.791108"></use>
<use x="224.995052" xlink:href="#g3-112n5" y="77.791108"></use>
</g>
</svg></p>
<p><a href="https://camo.githubusercontent.com/63fb6ccf79f732f176d516b102f37819d0e5f6571502f8922e26fd054720d754/68747470733a2f2f646576656c6f7065722e6e76696469612e636f6d2f73697465732f64656661756c742f66696c65732f616b616d61692f67616d65776f726b732f626c6f672f4465707468707265636973696f6e2f6772617068352e6a7067" target="_blank" rel="nofollow"><img src="https://camo.githubusercontent.com/63fb6ccf79f732f176d516b102f37819d0e5f6571502f8922e26fd054720d754/68747470733a2f2f646576656c6f7065722e6e76696469612e636f6d2f73697465732f64656661756c742f66696c65732f616b616d61692f67616d65776f726b732f626c6f672f4465707468707265636973696f6e2f6772617068352e6a7067" alt="" data-canonical-src="https://developer.nvidia.com/sites/default/files/akamai/gameworks/blog/Depthprecision/graph5.jpg" style="max-width:100%;"></a></p>
<p>但在OpenGL中，由于z值映射到[-1,1]，远平面部分的数据精度被破坏，无法直接使用这种方法</p>
<p><a href="https://camo.githubusercontent.com/6854694702827a1b829a1524e7b1535b608c7a8c516e5a42bacbe5affa6f2308/68747470733a2f2f646576656c6f7065722e6e76696469612e636f6d2f73697465732f64656661756c742f66696c65732f616b616d61692f67616d65776f726b732f626c6f672f4465707468707265636973696f6e2f6772617068362e6a7067" target="_blank" rel="nofollow"><img src="https://camo.githubusercontent.com/6854694702827a1b829a1524e7b1535b608c7a8c516e5a42bacbe5affa6f2308/68747470733a2f2f646576656c6f7065722e6e76696469612e636f6d2f73697465732f64656661756c742f66696c65732f616b616d61692f67616d65776f726b732f626c6f672f4465707468707265636973696f6e2f6772617068362e6a7067" alt="" data-canonical-src="https://developer.nvidia.com/sites/default/files/akamai/gameworks/blog/Depthprecision/graph6.jpg" style="max-width:100%;"></a></p>
OpenGL 
<h3>
<a id="user-content-multiple-frusta" class="anchor" href="#multiple-frusta" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>multiple frusta</h3>
<p>rtr4中另一种减少z fighting的做法，渲染多个frustum</p>
<p>Cozzi proposes to use multiple frusta, which can improve accuracy to effectively any desired rate. The view frustum is divided in the depth direction into
several non-overlapping smaller sub-frusta whose union is exactly the frustum. The
sub-frusta are rendered to in back-to-front order. First, both the color and depth
buffers are cleared, and all objects to be rendered are sorted into each sub-frusta that
they overlap. For each sub-frusta, its projection matrix is set up, the depth buffer is
cleared, and then the objects that overlap the sub-frusta are rendered.</p>
<h3>
<a id="user-content-early-z" class="anchor" href="#early-z" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>early-z</h3>
<p>在late depth test中，是在fragmentshader后计算z值，做深度测试，early-z是在fragmentshader之前计算z值，并根据可视性discard掉多余的像素，这一功能已经集成在图形api中</p>
<p><strong>reference:</strong></p>
<p><a href="https://developer.nvidia.com/content/depth-precision-visualized" rel="nofollow">https://developer.nvidia.com/content/depth-precision-visualized</a>
<a href="http://www.adriancourreges.com/blog/2015/11/02/gta-v-graphics-study/" rel="nofollow">http://www.adriancourreges.com/blog/2015/11/02/gta-v-graphics-study/</a>
<a href="https://www.khronos.org/opengl/wiki/Depth_Buffer_Precision" rel="nofollow">https://www.khronos.org/opengl/wiki/Depth_Buffer_Precision</a>
<a href="https://www.gamedev.net/forums/topic.asp?topic_id=539378" rel="nofollow">https://www.gamedev.net/forums/topic.asp?topic_id=539378</a>
<a href="http://www.humus.name/index.php?page=News&amp;ID=255" rel="nofollow">http://www.humus.name/index.php?page=News&amp;ID=255</a></p>

                        </article>
                    </div>
                </div>
            </div>
        </div>
        
        
     </div>
 </div>
