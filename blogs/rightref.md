# c++ 右值/右值引用/移动语义/完美转发


左值和右值是一个历史遗留的概念，c++11前，表达式被分为左值和右值，左值是可以出现在赋值运算符左边的表达式，右值是仅能出现赋值运算符右边的表达式。

随着移动语义引入到 C++11 之中，值类别被重新进行了定义。

## 值类别

每个c++表达式都有类型和值类别，每个表达式都有一个非引用的类型，且都属于三个主要的值类别，纯右值，将亡值，泛左值

- 泛左值：是其求值确定一个对象、位域或函数的个体的表达式

- 纯右值：是一个求值满足以下条件的表达式
    - 计算某个内置运算符的操作数的值（这种纯右值没有结果对象）
    - 初始化某个对象或位域（称这种纯右值有一个结果对象）。除 decltype 外，所有类和数组的纯右值都有结果对象，即使它被舍弃也是如此。结果对象可以是变量，由 new 表达式创建的对象，由临时量实质化创建的临时对象，或者前述三类对象的成员；
- 亡值 (xvalue)（“将亡 (expiring)”的值）是代表其资源能够被重新使用的对象或位域的泛左值；


### 基本类别

#### 左值

**下列表达式是左值表达式：**

- 变量、函数、模板形参对象 (C++20 起)或数据成员的名字，不论其类型，例如 std::cin 或 std::endl。即使变量的类型是右值引用，由其名字构成的表达式仍是左值表达式；
- 返回类型为左值引用的函数调用或重载运算符表达式，例如 std::getline(std::cin, str)、std::cout << 1、str1 = str2 或 ++it；
- a = b，a += b，a %= b，以及所有其他内建的赋值及复合赋值表达式；
++a 和 --a，内建的前置自增与前置自减表达式；
- *p，内建的间接寻址表达式；
- a[n] 和 n[a]，内建的下标表达式，当 a[n] 中的一个操作数为数组左值时 (C++11 起)；
- a.m，对象成员表达式，除了 m 为成员枚举项或非静态成员函数，或者 a 为右值而 m 为对象类型的非静态数据成员的情况；
- p->m，内建的指针成员表达式，除了 m 为成员枚举项或非静态成员函数的情况；
- a.*mp，对象的成员指针表达式，其中 a 是左值且 mp 是数据成员指针；
- p->*mp，内建的指针的成员指针表达式，其中 mp 是数据成员指针；
- a, b，内建的逗号表达式，其中 b 是左值；
- a ? b : c，对某些 b 和 c 的三元条件表达式（例如，当它们都是同类型左值时，但细节见其定义）；
- 字符串字面量，例如 "Hello, world!"；
- 转换为左值引用类型的转型表达式，例如 static_cast<int&>(x)；

**性质**

- 与泛左值相同（见下文）。
- 可以由内建的取址运算符取左值的地址：&++i[1] 及 &std::endl 是合法表达式。
- 可修改的左值可用作内建赋值和内建复合赋值运算符的左操作数。
- 左值可用于初始化左值引用；这会将一个新名字关联给该表达式所标识的对象。


#### 纯右值

**下列表达式是纯右值表达式：**

- （除了字符串字面量之外的）字面量，例如 42、true 或 nullptr；
返回类型是非引用的函数调用或重载运算符表达式，例如 str.substr(1, 2)、str1 + str2 或 it++；
- a++ 和 a--，内建的后置自增与后置自减表达式；
- a + b、a % b、a & b、a << b，以及其他所有内建的算术表达式；
- a && b、a || b、!a，内建的逻辑表达式；
- a < b、a == b、a >= b 以及其他所有内建的比较表达式；
- &a，内建的取地址表达式；
- a.m，对象成员表达式，其中 m 是成员枚举项或非静态成员函数[2]，或其中 a 为右值且 m 为非引用类型的非静态数据成员 (C++11 前)；
- p->m，内建的指针成员表达式，其中 m 为成员枚举项或非静态成员函数[2]；
- a.*mp，对象的成员指针表达式，其中 mp 是成员函数指针[2]，或其中 a 为右值且 mp 为数据成员指针 (C++11 前)；
- p->*mp，内建的指针的成员指针表达式，其中 mp 是成员函数指针[2]；
- a, b，内建的逗号表达式，其中 b 是右值；
- a ? b : c，对某些 b 和 c 的三元条件表达式（细节见其定义）；
- 转换为非引用类型的转型表达式，例如 static_cast<double>(x)、std::string{} 或 (int)42；
- this 指针；
- 枚举项;
- 非类型模板形参，除非其类型为类或 (C++20 起)左值引用类型；

**性质：**

- 与右值相同（见下文）。
- 纯右值不具有多态：它所标识的对象的动态类型始终为该表达式的类型。
- 非类非数组的纯右值不能有 cv 限定，除非它被实质化以绑定到 cv 限定类型的引用 (C++17 起)。（注意：函数调用或转型表达式可能生成非类的 - cv 限定类型的纯右值，但其 cv 限定符通常被立即剥除。）
- 纯右值不能具有不完整类型（除了类型 void（见下文），或在 decltype 说明符中使用之外）
- 纯右值不能具有抽象类类型或其数组类型。

#### 将亡值


## 右值引用



## 移动语义

c++11 引入了移动语义，允许我们定义移动构造函数和移动赋值运算符，典型的移动构造函数“窃取”实参曾保有的资源（例如指向动态分配对象的指针，文件描述符，TCP socket，输入输出流，运行的线程，等等），而非复制它们

移动构造函数/移动赋值运算符接受一个右值引用作为参数，我们可以用std::move()获得任意表达式的右值引用


ref:
https://en.cppreference.com/w/cpp/language/value_category